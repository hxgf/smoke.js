!function(e,t){"use strict";var n={smoketimeout:[],init:!1,zindex:1e3,i:0,bodyload:function(e){var i=t.createElement("div");i.setAttribute("id","smoke-out-"+e),i.className="smoke-base",i.style.zIndex=n.zindex,n.zindex++,t.body.appendChild(i)},newdialog:function(){var t=(new Date).getTime();t=Math.random(1,99)+t,n.init?n.bodyload(t):n.listen(e,"load",function(){n.bodyload(t)}),n.newid=t},build:function(t,i){n.i++,i.stack=n.i,t=t.replace(/\n/g,"<br />"),t=t.replace(/\r/g,"<br />");var o,a="",l="OK",c="Cancel",d="",u="";"prompt"===i.type&&(a='<div class="dialog-prompt"><input id="dialog-input-'+n.newid+'" type="text" '+(i.params.value?'value="'+i.params.value+'"':"")+" /></div>"),i.params.ok&&(l=i.params.ok),i.params.cancel&&(c=i.params.cancel),i.params.classname&&(d=i.params.classname),"signal"!==i.type&&(u='<div class="dialog-buttons">',"alert"===i.type?u+='<button id="alert-ok-'+n.newid+'">'+l+"</button>":"quiz"===i.type?(i.params.button_1&&(u+='<button class="quiz-button" id="'+i.type+"-ok1-"+n.newid+'">'+i.params.button_1+"</button>"),i.params.button_2&&(u+='<button class="quiz-button" id="'+i.type+"-ok2-"+n.newid+'">'+i.params.button_2+"</button>"),i.params.button_3&&(u+='<button class="quiz-button" id="'+i.type+"-ok3-"+n.newid+'">'+i.params.button_3+"</button>"),i.params.button_cancel&&(u+='<button id="'+i.type+"-cancel-"+n.newid+'" class="cancel">'+i.params.button_cancel+"</button>")):("prompt"===i.type||"confirm"===i.type)&&(u+=i.params.reverseButtons?'<button id="'+i.type+"-ok-"+n.newid+'">'+l+'</button><button id="'+i.type+"-cancel-"+n.newid+'" class="cancel">'+c+"</button>":'<button id="'+i.type+"-cancel-"+n.newid+'" class="cancel">'+c+'</button><button id="'+i.type+"-ok-"+n.newid+'">'+l+"</button>"),u+="</div>"),o='<div id="smoke-bg-'+n.newid+'" class="smokebg"></div><div class="dialog smoke '+d+'"><div class="dialog-inner">'+t+a+u+"</div></div>",n.init?n.finishbuild(t,i,o):n.listen(e,"load",function(){n.finishbuild(t,i,o)})},finishbuild:function(e,i,o){var a=t.getElementById("smoke-out-"+n.newid);for(a.className="smoke-base smoke-visible  smoke-"+i.type,a.innerHTML=o;""===a.innerHTML;)a.innerHTML=o;switch(n.smoketimeout[n.newid]&&clearTimeout(n.smoketimeout[n.newid]),n.listen(t.getElementById("smoke-bg-"+n.newid),"click",function(){n.destroy(i.type),"prompt"===i.type||"confirm"===i.type||"quiz"===i.type?i.callback(!1):"alert"===i.type&&"undefined"!=typeof i.callback&&i.callback()}),i.type){case"alert":n.finishbuildAlert(e,i,o);break;case"confirm":n.finishbuildConfirm(e,i,o);break;case"quiz":n.finishbuildQuiz(e,i,o);break;case"prompt":n.finishbuildPrompt(e,i,o);break;case"signal":n.finishbuildSignal(e,i,o);break;default:throw"Unknown type: "+i.type}},finishbuildAlert:function(i,o){n.listen(t.getElementById("alert-ok-"+n.newid),"click",function(){n.destroy(o.type),"undefined"!=typeof o.callback&&o.callback()}),t.onkeyup=function(t){t||(t=e.event),(13===t.keyCode||32===t.keyCode||27===t.keyCode)&&(n.destroy(o.type),"undefined"!=typeof o.callback&&o.callback())}},finishbuildConfirm:function(i,o){n.listen(t.getElementById("confirm-cancel-"+n.newid),"click",function(){n.destroy(o.type),o.callback(!1)}),n.listen(t.getElementById("confirm-ok-"+n.newid),"click",function(){n.destroy(o.type),o.callback(!0)}),t.onkeyup=function(t){t||(t=e.event),13===t.keyCode||32===t.keyCode?(n.destroy(o.type),o.callback(!0)):27===t.keyCode&&(n.destroy(o.type),o.callback(!1))}},finishbuildQuiz:function(i,o){var a=t.getElementById("quiz-ok1-"+n.newid),l=t.getElementById("quiz-ok2-"+n.newid),c=t.getElementById("quiz-ok3-"+n.newid);n.listen(t.getElementById("quiz-cancel-"+n.newid),"click",function(){n.destroy(o.type),o.callback(!1)}),a&&n.listen(a,"click",function(){n.destroy(o.type),o.callback(a.innerHTML)}),l&&n.listen(l,"click",function(){n.destroy(o.type),o.callback(l.innerHTML)}),c&&n.listen(c,"click",function(){n.destroy(o.type),o.callback(c.innerHTML)}),t.onkeyup=function(t){t||(t=e.event),27===t.keyCode&&(n.destroy(o.type,n.newid),o.callback(!1))}},finishbuildPrompt:function(i,o){var a=t.getElementById("dialog-input-"+n.newid);setTimeout(function(){a.focus(),a.select()},100),n.listen(t.getElementById("prompt-cancel-"+n.newid),"click",function(){n.destroy(o.type),o.callback(!1)}),n.listen(t.getElementById("prompt-ok-"+n.newid),"click",function(){n.destroy(o.type),o.callback(a.value)}),t.onkeyup=function(t){t||(t=e.event),13===t.keyCode?(n.destroy(o.type),o.callback(a.value)):27===t.keyCode&&(n.destroy(o.type),o.callback(!1))}},finishbuildSignal:function(i,o){t.onkeyup=function(t){t||(t=e.event),27===t.keyCode&&(n.destroy(o.type),"undefined"!=typeof o.callback&&o.callback())},n.smoketimeout[n.newid]=setTimeout(function(){n.destroy(o.type),"undefined"!=typeof o.callback&&o.callback()},o.timeout)},destroy:function(i){var o,a=n.newid,l=t.getElementById("smoke-out-"+a);"quiz"!==i&&(o=t.getElementById(i+"-ok-"+a));var c=t.getElementById(i+"-cancel-"+a);if(l.className="smoke-base",o&&(n.stoplistening(o,"click",function(){}),t.onkeyup=null),"quiz"===i)for(var d=t.getElementsByClassName("quiz-button"),u=0;u<d.length;u++)n.stoplistening(d[u],"click",function(){}),t.onkeyup=null;c&&n.stoplistening(c,"click",function(){}),"signal"===i&&e.clearTimeout(n.smoketimeout[n.newid]),n.i=0,t.body.removeChild(l),n.newid=null},alert:function(e,t,i){"object"!=typeof i&&(i=!1),n.newdialog(),n.build(e,{type:"alert",callback:t,params:i})},signal:function(e,t,i){"object"!=typeof i&&(i=!1);var o=5e3;"undefined"!==i.duration&&(o=i.duration),n.newdialog(),n.build(e,{type:"signal",callback:t,timeout:o,params:i})},confirm:function(e,t,i){"object"!=typeof i&&(i=!1),n.newdialog(),n.build(e,{type:"confirm",callback:t,params:i})},quiz:function(e,t,i){"object"!=typeof i&&(i=!1),n.newdialog(),n.build(e,{type:"quiz",callback:t,params:i})},prompt:function(e,t,i){return"object"!=typeof i&&(i=!1),n.newdialog(),n.build(e,{type:"prompt",callback:t,params:i})},listen:function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):!1},stoplistening:function(e,t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):!1}};n.init=!0,"undefined"!=typeof module&&module.exports?module.exports=n:"function"==typeof define&&define.amd?define("smoke",[],function(){return n}):e.smoke=n}(window,document);
